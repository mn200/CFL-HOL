# this is a -*- makefile -*-

-include Makefile.local
MASTER_DOC_ROOT = pda
.DEFAULT_GOAL := $(MASTER_DOC_ROOT).pdf
onlysources.tex ?= $(MASTER_DOC_ROOT).tex
TEX_SOURCES = pda introduction cfg pdaDef cfg2pda pda2cfg conclusion cfls laeslafs trees hol
HOLDIR ?= $(HOME)/Apps/HOL
THISDIR := $(shell pwd)
MASTER_THEORY := prettyPrintingTheory

OVERRIDES = $(shell if [ -r overrides ] ; then echo overrides ; fi)

prettyPrintingTheory.uo: prettyPrintingScript.sml  ../pda/pdaEqCfgTheory.uo ../pda/closureTheory.uo ../pda/homomorphismTheory.uo
	$(HOLDIR)/bin/Holmake $@

# BUILD_STRATEGY := pdflatex


export TEXINPUTS := $(TEXINPUTS):$(HOLDIR)/src/TeX:$(THISDIR)/figures:$(THISDIR)/tables:$(THISDIR)/sty

munger: $(MASTER_THEORY).uo
	$(HOLDIR)/bin/mkmunge.exe -o $@ $(MASTER_THEORY)

%.tex: %.htex $(OVERRIDES) munger
	@-chmod -f +w $@ 2> /dev/null
	(echo "% Don't edit this file; it's generated by the HOL-TeX munger"; \
         ./munger $(OVERRIDES) < $<) > $@
	@chmod -w $@

$(MASTER_DOC_ROOT).d: $(patsubst %,%.tex,$(TEX_SOURCES))

.PHONY: gentex_clean
gentex_clean:
	@for i in *.tex ; do if [ -f `basename $$i .tex`.htex ] ; then rm -f $$i ; fi ; done

clean: gentex_clean
	@/bin/rm holtexbasic.sty

holtexbasic.sty: $(HOLDIR)/src/TeX/holtexbasic.sty
	$(CP) $< $@
